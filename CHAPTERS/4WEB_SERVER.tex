\chapter{Webový server}
Webový server je~nejdůležitější a~nejobsáhlejší část celého systému. 
Webový server mám nasazený na mikropočítači Raspberry Pi 4 Model B který má 8GB operační paměti.
Toto zařízení jsem zvolil hlavně kvůli nízké spotřebě elektrické energie a velké komunitě lidí, kteří tento mikropočítač využívají.
Na zařízení běží operační systém Raspberry Pi OS s grafickým rozhraním.

Webové stránky běží na HTTP serveru Apache2 a PHP 7.3.
Jako databázový systém využívám MariaDB.
Server běží lokálně uvnitř firmy na zabezpečené sítí, tím pádem není nutné velké zabezpečení systému.
Z toho také vyplývá, že stránka je dostupná pouze ve vnitřní síti firmy.  
Celý webový server mám verzovaný také na Githubu.\newline
Github: \href{https://github.com/Pletacka-IoT/Pletacka-website}{Pletacka-website} 

%SECTION
\section{Fronted}
% Frontend neboli vizuální část webové stránky je pro uživatele ta nejdůležitější.
% Webový design musí zaujmout a udržet si diváka.
% V aktuální době plné mobilních telefonů je důležité aby se aplikace správně zobrazovala i na takto malých zařízeních.
 
Frontend je vizuální část webové stránky zobrazená uživatelem.
Pomocí frontendu se na obrazovku vykreslují veškerý text a jednotlivé prvky stránky.

\subsection{Bootstrap}
Bootstrap je knihovna sloužící k jednoduchému a rychlému vytvoření responzivních webových stránek.
Díky této knihovně jsou stránky správně zobrazovány i na mobilních zařízeních.
Knihovna nabízí propracované grafické a pozicovací příkazy.
Tento nástroj se vyvíjí od roku 2011 a je pod otevřenou licencí.
Webový server využívá Bootstrap ve verzi čtyři.


\subsection{JavaScript}
Na webovém serveru využívám JavaScript primárně k aktualizaci části stránek.
Tato technologie se nazývá AJAX a umožňuje překreslovat vybrané části stránek.
Načítání stánek je tím pádem rychlejší a šetří přenesená data.
K tomuto efektivnímu překreslování používám knihovnu Naja\cite{NAJA}, kterou napsal český vývojář Jiří Pudil.
Knihovna také nabízí jednoduchou integraci do PHP frameworku, o kterém budu psát dále.   



%SECTION
\section{Backend}
Je to nejobsáhlejší část celé této práce. 
Backend je serverová část webové stránky, neběží tedy u vás na počítači jako frontend, ale na webovém serveru.   
Celý backend systému Pletačka IoT jsem napsal v programovacím jazyce PHP a běží na frameworku Nette\cite{NETTE}, který nabízí ucelenou sadu nástrojů k tvorbě webů.
Backend se stará o přijímání dotazů ze senzorů a následný zápis do databáze, pohání celý webový server a vytváří databázové výběry.
Nejdříve zde popíšu použité technologie a následně rozeberu princip aplikace.

\subsection{PHP}
Webovou aplikaci programuji v PHP ve verzi 7.3. Jako programovací studio jsem zvolil studentskou verzi aplikace PHPStorm, která je velmi mocným nástrojem při tvorbě webu.
Testovací verze aplikace mám rozjetou na svém počítači kde také celý tento systém vyvíjím. K zasazení aplikace na Raspberry Pi webový server využívám také studio PHPStorm které se pomocí protokolu SSH. 
Funkce také nabízí jednoduché porovnávání změn s produkční verzí a chytrou aktualizaci zdrojových souborů.

Pro snadnější ladění chyb používám Xdebug, díky kterému si můžu krokovat jednotlivé řádky kódu a rychleji tak nalézt chybu.

Jako systém pro správu balíčků používám nástroj Composer, který se ovládá z terminálu pomocí jednoduchých příkazů.
Umožňuje jednoduchou definici závislostí a aktualizaci všech modulů pomocí jednoho příkazu.


\subsection{Nette}
Nette je webový framework vyvíjený komunitou. Vznikl v České republice a jeho zakladatelem je David Grudl. 
Nabízí vlastní šablonovací jazyk, na jednoduchou a efektivní tvorbu webových stránek. 
Nette disponuje obsáhlou a velmi dobře zpracovanou dokumentací, ale také velkou komunitou lidí kteří s tímto frameworkem pracují a velmi dobře mu rozumí. 


\subsection{API}
Webová stránka Pletačka IoT obsahuje základní sadu API.
Primárně ji využívají senzory k odesílání naměřených dat a ke zpětnému posílání odpovědí do senzoru.
Druhé využití API je k vytváření databázových výberů, to je voláno nástrojem na automatizaci procesů v nastavený čas. 


%SECTION
\section{Webové rozhraní Pletačka IoT}
Každá stránka stránka je rozdělena na tři části. Záhlaví, to obsahuje logo stránek a odkazy na nejpoužívanější stránky.
Druhou částí jsou samotné webové stránky které budou popsány v dalších odstavcích.
Poslední částí je minimalistické zápatí s copyright znakem.\newline
Stránky Pletačky jsem navrhoval tak, aby splňovaly tyto paramtery:

\fxnote[author=JA]{\textcolor{mygreen}{Doplňit obrázky stránek pod kapitolu nebo jeden list s fotkama}}

\begin{itemize}
    \item jednoduché rozhraní pro uživatele
    \item přehledné zobrazení day
    \item zobrazovat pouze užitečná dat
    \item rychlá editace senzorů
    \item využití zavedeného číselného identifikátoru 
\end{itemize}

\subsection{Úvodní stránka}
V horní části úvodní stránky se vypisují tři nejpodstatnější údaje.
Jde o celkový počet upletených párů za aktuální směnu.
Dále pak úspěšnost vypočítávanou z času zastavení stroje a z cekové času zapnutí stroje.
Posledním údajem je průměrná doba stání jednoho stroje.   

Pod těmito čísly se zobrazuje tabulka s barevnými obdelníčky, kde každý představuje jeden stroj.
Barva obdelníčku udává aktuální stav stroje a text v pozadí tuto informaci doplňuje. 

\subsection{Přehled ze senzoru}
Po kliknutí na senzor na úvodní stránce, se zobrazí data o právě vybraném stroji.
Veškerá data jsou rozdělena do dvou sloupců podle pracovních směn.
To umožňuje zaměstnavateli jednoduché porovnávání směn.
V úvodu každého sloupce je obecný přehled naměřených dat za různá období.
Pod obsahem je přehled v grafech a porovnání nejdůležitější údajů.

\subsection{Správa senzorů}
Pro vstup do této sekce je nutné uživatelské přihlášení do systému.
Stránka pak nabízí přehled senzorů s jednotlivými možnostmi úpravy.

První z odkazů vede na aktuální přehled ze senzoru.
Druhý řeší editaci senzoru a poslední maže vybraný senzor.


\subsection{Nastavení směn}
Jednoduchá stránka na které se nastavuje pořadí směn.
Střídání směn probíhá pravidelně po týdnech, proto je nastavení velmi jednoduché.

%SECTION
\section{Databáze}
Databáze je rozdělená do dvou skupin tabulek.

První skupina tabulek je nastavovací, jedná se o hlavní nastavení webu, nastavení směn a o tabulku s uživateli a jejich oprávněním.

Druhá skupina je senzorová.
Každý senzor zde má pět tabulek na ukládání svých dat.
První senzorová tabulka ukládá čistá nezpracovaná data posílaná přímo ze senzoru.
Zbylé čtyři tabulky jsou databázové výběry různých časových úseků, jde o výber hodinový, denní, měsíční a roční.  
Tyto tabulky se vytvářejí automaticky pomocí výběrového API.

Struktura tabulek je vyobrazena ve schématu níže.
\fxnote[author=JA]{\textcolor{mygreen}{Scéma struktury tabulek}}


% \subsection{Popis fungování systému}
% Každý senzor pri změně stavu odešle svůj nový stav na server, kde se následně uloží do tabulky daného senzoru.

% Program na automatizaci procesů volá každou hodinu nástroj na generování databázových výberů které urychlují následné zobrazování dat.



\newpage